## 如果真想玩转C语言，就需要理解C语言如何操纵存储器

C语言在如何使用存储器方面赋予了你更多的掌控权。在本章中，你将揭开存储器神秘的面纱，看到读写变量时到底发生了什么；学习数组的工作原理，以及怎样避免烦人的存储器错误；最重要的是，你将看到掌握指针和存储器寻址对成为一名地道的C程序员来讲有多么重要。

### 1、C代码包含*指针*

指针是理解C语言最基本的要素之一。那么什么是指针？指针就是存储器中某条数据的地址。
```
C语言中使用指针的原因:
    1. 在函数调用时，可以只传递一个指针，而不用传递整份数据。
    2. 让两段代码处理同一条数据，而不是处理两份独立的副本。
```
指针做了两件事：避免副本和共享数据。但既然指针只是地址而已，为什么它会令很多人感到困惑呢？因为指针是一种间接形式的地址。在茫茫储存器中追逐指针，一不小心就会迷路。而学习C指针的诀窍就是慢慢来。

### 2、深入挖掘存储器

为了理解什么是指针，需要切开计算机的存储器。 每当声明一个变量，计算机都会在存储器中某个地方为它创建空间。 如果在函数（例如main()函数）中声明变量，计算机会把它保存在栈（Stack）的存储器区段中；如果你在函数以外的地方声明变量，计算机则会把它保存在存储器的全局量段（Globals）。

```
int y = 1; /* 变量y位于全局变量段。存储器地址1 000 000。值为1 */
int main() {
    int x = 4; /* 变量x位于栈中。存储器地址4 100 000。值为4 */
    return 0;
}
+-------------------------------------------+
+           x[4]                    栈      +
+-------------------------------------------+
+                                   堆      +
+-------------------------------------------+
+           y[1]                    全局量   +
+-------------------------------------------+
+                                   常量段   +
+-------------------------------------------+
+                                   代码段   +
+-------------------------------------------+
```
如果想要找到变量的存储器地址，可以用&运算符：

```
printf("x保存在 %p\n", &x);
    x保存在 0x3E8FA0  --->你的电脑可能得到不同的值
              ^----------这是4 100 000十六进制的表示

为什么局部变量保存在栈里，而全局变量保存在其它地方？
    局部变量和全局变量的用法不同。你永远只能得到一份全局变量，但如果写来一个调用自己的函数，就会得到同一个局部变量的很多个实例。

存储器中的其它区域是用来做什么的？
    你会在后序章节中看到它们的作用。
```

### 3、使用存储器指针

1. 得到变量的地址

```
用&运算符找到变量保存在存储器中的位置，你已经知道了：
            
            int x = 4;
            printf("x lives at %p\n", &x);

一旦得到了变量的地址，就需要把它保存在某个地方。为此需要指针变量。指针变量是一个用来保存存储器地址的变量。
            
            int *address_of_x = &x;
```

2. 读取地址的内容

```
当你有了存储器地址，就想读取保存在那里的数据，这是可以用*运算符：

            int value_stored = *address_of_x;

*运算符和&运算符恰好相反。&运算符接受一个数据，然后告诉你这个数据保存在哪里；*运算符接收一个地址，然后告诉你这个地址中保存的是什么数据。
因此指针有时也叫引用，所以*运算符也可以描述成对指针进行解引用。
```

3. 改变地址的内容

```
如果你有一个指针变量，并想修改这个变量指向地址中的数据，可以再次使用*运算符，只不过这次需要把指针变量放在赋值运算符左边。

            *address_of_x = 99;
```

```
指针是真实的地址单元，还是某种形式的引用？
    它们是进程存储器中真实编号的地址。

为什么存储器是进程的？
    计算机会为每个进程分配一个简版存储器，看起来就像是一长串字节。

但存储器并非如此？
    实际但存储器复杂多了，但细节对进程隐藏了起来，这样操作系统就可以在存储器中移动进程，或释放并重新加载到其它位置。

存储器不仅仅是一长列字节？
    物理存储器的结构十分复杂，计算机通常会将存储器地址分组映射到存储芯片的不同的存储体。
```
